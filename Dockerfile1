# Use a base image (e.g., OpenJDK or any base image)
FROM openjdk:11-jre-slim
WORKDIR /app
# Get the AWS CodeArtifact token for Maven (if using Maven)
RUN export CODEARTIFACT_TOKEN=$(aws codeartifact get-authorization-token --domain assyvajrala --domain-owner 688567283917  --region us-east-1 --query authorizationToken --output text) && \
    echo "<settings><servers><server><id>aws</id><username>aws</username><password>${CODEARTIFACT_TOKEN}</password></server></servers></settings>" > /root/.m2/settings.xml

# Alternatively, you can fetch the artifact manually (e.g., JAR file)
RUN aws codeartifact get-package-version --domain assyvajrala --repository marvel --package com.assy.com:cluster_jar --package-version 1.0-20250305.064417-1 --region us-east-1 --output text

# Copy the artifact into your container
COPY . .

# Continue with the Dockerfile, for example, setting up the app or starting a service
# RUN mvn clean install -DskipTests

# Expose a port or set the command to run your app
#CMD ["java", "-jar", "/app/your-artifact.jar"]
CMD ["sh", "-c", "while true; do java -jar /app/cluster_jar-1.0-20250305.064417-1.jar; sleep 5; done"]
